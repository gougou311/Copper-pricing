# Copper-pricing
pip install yfinance matplotlib seaborn pandas
import matplotlib.pyplot as plt
import matplotlib.gridspec as gridspec
from matplotlib.backends.backend_pdf import PdfPages
import numpy as np
import pandas as pd
import seaborn as sns

plt.style.use('seaborn-v0_8-whitegrid')


def create_polished_pdf_report():
    
    
    # ==========================================
    # 数据生成 (保持不变)
    # ==========================================
    np.random.seed(42)
    
    # 模拟历史数据 (2024-2025)
    dates_hist = pd.date_range(start='2024-01-07', end='2025-01-06', freq='B')
    price_hist = 90 * np.cumprod(1 + np.random.normal(0.0002, 0.015, len(dates_hist)))
    
    # 模拟预测数据 (2025-2026)
    dates_pred = pd.date_range(start='2025-01-07', end='2026-01-07', freq='B')
    start_price = price_hist[-1]
    price_pred = start_price * np.cumprod(1 + np.random.normal(0.0005, 0.018, len(dates_pred)))
    
    # 构建DataFrame
    df_hist = pd.DataFrame({'Date': dates_hist, 'Price': price_hist})
    df_pred = pd.DataFrame({'Date': dates_pred, 'Price': price_pred})
    
    # 计算指标
    returns_pred = df_pred['Price'].pct_change().dropna()
    var_95 = np.percentile(returns_pred, 95) 
    es_95 = returns_pred[returns_pred > var_95].mean()

   
        # --- Plot 1: 趋势图  ---
        ax_plot1 = fig.add_subplot(gs[3:8, :])
        
        ax_plot1.plot(df_hist['Date'], df_hist['Price'], color='gray', alpha=0.7, label='Historical (2024-2025)', linewidth=1.5)
        ax_plot1.plot(df_pred['Date'], df_pred['Price'], color='#E4393C', label='Forecast (2025-2026)', linewidth=2)
        
        ax_plot1.axvline(df_pred['Date'].iloc[0], color='black', linestyle='--', alpha=0.5)
        ax_plot1.text(df_pred['Date'].iloc[0], ax_plot1.get_ylim()[0]*1.01, ' Current Date', rotation=90, va='bottom', fontsize=9)
        
        ax_plot1.set_title('Price Trend Comparison: Historical Actuals vs. Future Simulation', fontsize=12, fontweight='bold')
        ax_plot1.set_ylabel('Price Index (USD)')
        ax_plot1.legend(loc='upper left')
        ax_plot1.grid(True, alpha=0.3)

     

        # --- Plot 2: 分布图  ---
        
        ax_plot2 = fig.add_subplot(gs[10:14, :])
        
        sns.histplot(returns_pred, bins=50, kde=True, ax=ax_plot2, color='orange', alpha=0.6)
        
        ax_plot2.axvline(var_95, color='red', linestyle='--', linewidth=2)
        ax_plot2.text(var_95*1.1, ax_plot2.get_ylim()[1]*0.8, f'VaR (95%): {var_95:.2%}\n(Budget Buffer)', color='darkred', fontweight='bold')
        
        ax_plot2.axvline(es_95, color='black', linestyle=':', linewidth=2)
        es_text_pos = es_95*1.1
        ax_plot2.text(es_text_pos, ax_plot2.get_ylim()[1]*0.6, f'ES (95%): {es_95:.2%}\n(Hedging Trigger)', color='black', fontweight='bold')
        
        ax_plot2.set_title('Projected Volatility Distribution & Risk Thresholds (2025-2026)', fontsize=12, fontweight='bold')
        ax_plot2.set_xlabel('Daily Price Change (%)')

        # --- Footer  ---
        ax_footer = fig.add_subplot(gs[15, :])
        ax_footer.axis('off')
        ax_footer.text(0.5, 0.5, f"Analysis generated by Shuyue Li | Metrics: VaR={var_95:.2%}, ES={es_95:.2%}", 
                       ha='center', va='center', fontsize=9, color='gray')
        
        
        plt.subplots_adjust(top=0.95, bottom=0.05, hspace=0.5) 
        
        pdf.savefig(fig)
